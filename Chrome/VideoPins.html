<html>
<head>
<style>
    body
    {
        overflow: hidden;
    }
    iframe
    {
        width: 100%;
        height: 100%;
    }
    #VideoPins_Player
    {
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
        position: absolute;
    }    
    #embedVideoPins
    {
        top: -10000px;
        left: -10000px;
        position: absolute;
    }
</style>

<script type="text/javascript" src="VideoPins.js"></script>
<script type="text/javascript" src="http://www.youtube.com/player_api"></script>
<script>    
    var bg_page = chrome.extension.getBackgroundPage();
    var obj = JSON.parse(localStorage['video']);
    var m_Pin = null;
    var ytplayer = null;

    function onYouTubePlayerAPIReady()
    {
        ytplayer = new YT.Player('ytplayer', {
            events  : {
                'onReady': onPlayerReady,
                'onPlaybackQualityChange': onPlayerPlaybackQualityChange,
                'onStateChange': onPlayerStateChange,
                'onError': onPlayerError
            }
        });
    }

    function onPlayerReady(event)
    {
        var autoplay = bg_page.Options.get("autoplay");
        if(autoplay) ytplayer.playVideo();
    }

    function onPlayerPlaybackQualityChange(event)
    {
    }

    function onPlayerStateChange(event)
    {
        switch(event.data)
        { //unstarted (-1), ended (0), playing (1), paused (2), buffering (3), video cued (5). 
        case YT.PlayerState.UNSTARTED:
            console.log("UNSTARTED");
            break;

        case YT.PlayerState.ENDED:
            console.log("ENDED");
            m_Pin.ReHookWindow();
            break;

        case YT.PlayerState.PLAYING:
            console.log("PLAYING");
            m_Pin.ReHookWindow();
            break;

        case YT.PlayerState.PAUSED:
            console.log("PAUSED");
            m_Pin.UnHookWindow();
            break;

        case YT.PlayerState.BUFFERING:
            console.log("BUFFERING");
            break;

        case YT.PlayerState.CUED:
            console.log("CUED");
            break;
        }
    }

    function onPlayerError(event)
    {
    }
    
    // document.onclick = getMousePosition;
    function getMousePosition(e) 
    {
        posX = e.pageX;
        posY = e.pageY;
        alert(posX + '\n' + posY);
        return true;
    }
</script>
</head>
<body>
    <div id="VideoPins_Player"></div>

    <embed id="embedVideoPins" type="application/x-videopins">
    <script type="text/javascript">
        document.title = obj.title;
        document.getElementById('VideoPins_Player').innerHTML = obj.html;
        
        window.onload = function()
        {	// after page onloaded.
            m_Pin = new VideoPins(document.getElementById("embedVideoPins"));
            
            // windows XP offset: width=10, height=27. correct=650,418.
            // var hWnd = m_Pin.HookWindow(document.title, obj.x, obj.y, obj.width+bg_page.OS_windowOffsetW, obj.height+bg_page.OS_windowOffsetH);

            var hWnd = m_Pin.HookWindow(document.title, obj.x, obj.y, obj.width, obj.height);

            chrome.windows.getCurrent(
                function(window)
                {
                    var newPin = new Object();
                    newPin.hWnd = hWnd;
                    newPin.title = obj.title;
                    //alert(window.width +'\n' + window.height);
                    
                    bg_page.Pins.add(window.id, newPin);
                });
        }
        
    </script>

</body>
</html>
